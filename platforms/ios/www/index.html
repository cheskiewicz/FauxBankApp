<!DOCTYPE html> 
<html> 
	<head> 
	<meta charset="utf-8" /> 
	<title>iOS Inspired jQuery Mobile Theme</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"> 	 
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" rel="stylesheet" />
	<link href="ios_inspired/styles.css" rel="stylesheet" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="startApp.js"></script>
	<script>
        

    
 //       alert("Initial no");
        localStorage.setItem("comingFromMovenLogin","no");
		// all dialog buttons should close their parent dialog
		$(".ui-dialog button").live("click", function() {		
			$("[data-role='dialog']").dialog("close");		
		});
		$(document).on("mobileinit", function(){
		  $.mobile.defaultPageTransition = "slide";
		});
	</script>
	<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
	<style>
		#footerTabs {
			background: #FFF -webkit-radial-gradient(circle, #FFF, #dee2e4);
		}
		.ui-listview sup {
			font-size: 0.6em;
			color: #cc0000;
		}
	</style>

</head> 
<body> 
 
 <div data-role="page" id="loginPage">
     
<div style="margin-top: 100px; text-align:center; font-size: 30px;">
    
     <label id="mainTitle">myBank</label>
     </div>
<div align="middle">
 <img id="pic" align="middle" style="margin-top:20px;width:90px;height:90px;"><br><br>
    </div>

        
    <script>
  //      localStorage.setItem("comingFromMovenLogin","no");
  
        </script>
<div style="margin-top: 30px; text-align:center; font-size: 16px; color:red;">
    <label id="incorrectUsernamePassword"></label>
    </div>
     <div class="login-overlay" >
         <form id="loginForm" onsubmit="return false;">

             <div class="input-group" style="margin-top: 50px">
      <div class="input-row" style="padding-left:12px; padding-right:12px">
          
                     <input id="username" type="text" placeholder="Username" autocapitalize="off" autocorrect="off" autocomplete="off">
                         </div>
                 <div class="input-row" style="padding-left:12px; padding-right:12px">
                     <input id="password" type="password" placeholder="Password" autocapitalize="off" autocorrect="off" autocomplete="off">
                         </div>
             </div>
             <div class="action-group" style="padding-left:12px; padding-right:12px">
                 <button type="button" onclick="getAccessCodeFromServerAndLogin()">Log In</button>
                 <p class="forgotPasswordContact">
                 <p id="troubleTextID" style="padding-left:12px; line-height:20px;"></p>
                 <a href="#resetPassword" style="padding-left:14px; line-height:24px;font-size: 13px;" class="forgot-password" data-rel="page" >Reset your password</a> or <a href="#contactSupport" style="font-size: 13px;" class="forgot-username">Contact support</a><br>
 <!--                <label>test line</label>
                 <button type="button" onclick="getAccessCodeFromServerAndLogin()">Access Server</button>
                 </br>
                 <label >Access Code from other app:</label>-->
       <!--          <label id="dataPassedIn" style="font-size: 6px;"></label> -->
                 </p>
             </div>
         </form>
     </div>
 </div><!-- /page -->
 
 <div data-role="page" id="resetPassword">
     
     <div style="margin-top: 100px; text-align:left; font-size: 16px; padding-left:16px; padding-right:16px">
         <label>Enter your email address and we will send you an email to reset your password</label>
     </div>
     <div class="login-overlay" >
         <form id="loginForm" onsubmit="return false;">
             
             <div class="input-group" style="margin-top: 16px">
                 <div class="input-row" style="padding-left:12px; padding-right:12px">
                     <input name="username" type="text" placeholder="Email" autocapitalize="off" autocorrect="off" autocomplete="off">
                         </div>
             </div>
             <div class="action-group" style="padding-left:12px; padding-right:12px">
                 <a href="#loginPage" class="ui-btn-plain" data-role="button" data-rel="back" data-transition="slide">Submit</a>
                 
             </div>
         </form>
     </div>
 </div><!-- /page -->
 
 <div data-role="page" id="contactSupport">
     
     <div style="margin-top: 100px; text-align:left; font-size: 16px; padding-left:16px; padding-right:16px">
         <label>Enter your Email Address and a Message and we will get back to you within one business day.</label>
     </div>
     <div class="login-overlay" >
         <form id="loginForm" onsubmit="return false;">
             
             <div class="input-group" style="margin-top: 16px">
                 <div class="input-row" style="padding-left:12px; padding-right:12px">
                     <input name="username" type="text" placeholder="Email" autocapitalize="off" autocorrect="off" autocomplete="off">
                         <div data-role="fieldcontain">
                             <label for="textarea">Message:</label>
                             <textarea name="textarea" id="textarea"></textarea>
                         </div>
                         </div>
             </div>
             <div class="action-group" style="padding-left:12px; padding-right:12px">
                 <a href="#loginPage" class="ui-btn-plain" data-role="button" data-rel="back" data-transition="slide">Submit</a>
                 
             </div>
         </form>
     </div>
 </div><!-- /page -->
 
<div data-role="page" id="mainPage">
 
	<div data-role="header" data-position="fixed"> 
		<h1>myBank</h1>
	</div><!-- /header --> 
 
	<div data-role="content"> 
 
			
		<ul data-role="listview" data-inset="true"> 
            <li><a href="#viewAccounts">Accounts</a></li>
            <li><a href="#transfers">Payments and Transfers</a></li>
            <li><a href="#accountServices">Customer</a></li>
            <li><a href="javascript:myFunc()">Financial Wellness</a></li>
            <li><a href="#accountServices">Support</a></li>
            <li><a href="javascript:reset()">Logout</a></li>
		</ul> 
					
		<br />
			
		<br />
 
		</div><!-- /ui-body wrapper -->
</div><!-- /page --> 
  
<div data-role="page" id="accountServices">
 
	<div data-role="header" data-position="fixed">
		<h1>Account Services</h1>
		<a href="#" data-rel="back" data-theme="a">Back</a>
	</div><!-- /header -->
    
    <div data-role="content">
        
        <ul data-role="listview">
            <li data-role="list-divider">Credit Card</li>
            <li><a href="#">Custom Picture</a></li>
            <li><a href="#">Cancel Card</a></li>
            <li><a href="#">Change PIN</a></li>
            <li data-role="list-divider">My Profile</li>
            <li><a href="#">Change Username</a></li>
            <li><a href="#">Change Password</a></li>
            <li><a href="#">Contact Info</a></li>
            <li data-role="list-divider">Customer Service</li>
            <li><a href="#">Chat with representative</a></li>
            <li><a href="#">Frequently Asked Questions</a></li>
            <li><a href="#">Fraud Alert</a></li>
        </ul>
        
    </div>

</div>
  
<div data-role="page" id="branches">
 
	<div data-role="header" data-position="fixed">
		<h1>Branches</h1>
		<a href="#" data-rel="back" data-theme="a">Back</a>
	</div><!-- /header --> 
 
	<div data-role="content"> 
		
		<ul data-role="listview"> 
			<li data-role="list-divider">Pennsylvania</li>
			<li><a href="#">Sweet Valley</a></li>
			<li><a href="#">Wyoming</a></li>
			<li><a href="#">Smithfield</a></li>
			<li><a href="#">Dallas</a></li>
			<li><a href="#">Avoca</a></li>
			<li><a href="#">Bethlehem</a></li>
			<li><a href="#">Allentown</a></li>
			<li><a href="#">Pittsburgh</a></li>
            <li data-role="list-divider">New York</li>
			<li><a href="#">Tonawanda</a></li>
			<li><a href="#">Buffalo</a></li>
			<li><a href="#">Rochester</a></li>
			<li><a href="#">Syracus</a></li>
			<li><a href="#">Corning</a></li>
			<li><a href="#">Binghampton</a></li>
		</ul> 
		
	</div>
		
</div>
  
<div data-role="page" id="viewAccounts">
 
	<div data-role="header" data-position="fixed">
		<h1>Accounts</h1>
		<a href="#" data-rel="back" data-theme="a">Back</a>
		</a>
	</div><!-- /header -->
    
    <div data-role="content">
        
        <ul data-role="listview">
            <li data-role="list-divider">Checking</li>
            <li><a href="#">Moms Checking x3456</a></li>
            <li><a href="#">Dads Checking x2457</a></li>
            <li><a href="#">Joeys Debit Card x 7654</a></li>
            <li data-role="list-divider">Savings</li>
            <li><a href="#">Savings x9078</a></li>
            <li><a href="#">Tax Account x6753</a></li>
            <li><a href="#">Vacation Savings x5638</a></li>
            <li><a href="#">401K x2136</a></li>
        </ul> 
        
    </div>
 
</div>
  
<div data-role="page" id="transfers">
 
	<div data-role="header" data-position="fixed">
		<h1>Transfers</h1>
		<a href="#" data-rel="back" data-theme="a">Back</a>
	</div><!-- /header --> 
 
</div>

<div data-role="page" id="postDialogExample"> 
 
	<div data-role="content"> 
		<button data-theme="a">Post to Twitter</button>
		<button data-theme="a">Post to Facebook</button>
		<button data-theme="a">Post to YouTube</button>
		<button data-theme="b">Cancel</button>
	</div>
	
</div>
 
<div data-role="page" id="depositChecks">
 
	<div data-role="header" data-position="fixed">
		<h1>Dialogs</h1>
		<a href="#" data-rel="back" data-theme="a">Back</a>
	</div><!-- /header --> 
 
	<div data-role="content"> 
	
		<a href="#allDialogExample" class="ui-btn-plain" data-role="button" data-rel="dialog" data-transition="slideup">Take Front Photo</a>
	
		<a href="#deleteDialogExample" class="ui-btn-plain" data-role="button" data-rel="dialog" data-transition="slideup">Take Back Photo</a>
	
		<a href="#postDialogExample" class="ui-btn-plain" data-role="button" data-rel="dialog" data-transition="slideup">Deposit Check</a>
	
	</div>
		
</div>
  
<div data-role="page" id="billPay" data-theme="b">
 
	<div data-role="header" data-position="fixed">
		<h1>Bill Pay</h1>
		<a href="#" data-rel="back">Back</a>
	</div><!-- /header --> 
 <!--
	<div data-role="content"> 
	
		Icons by Joseph Wain / <a href="http://www.glyphish.com" target="_blank">glyphish.com</a>. Licensed under the <a href="http://creativecommons.org/licenses/by/3.0/us/" target="_blank">Creative Commons Attribution 3.0 United States License</a>.
	
	</div>
	
	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="#" id="tabA" data-icon="custom">One</a></li>
				<li><a href="#" id="tabB" data-icon="custom" class="ui-btn-active">Two</a></li>
				<li><a href="#" id="tabC" data-icon="custom">Three</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /footer -->
		
</div>

<div data-role="dialog" data-rel="dialog" data-transition="slideup" id="incorrectCredentials">
    
    <div data-role="header" data-position="fixed">
        <h1>Bill Pay</h1>
        <a href="#" data-rel="back">Back</a>
    </div><!-- /header -->
    <!--
     <div data-role="content">
     
     Icons by Joseph Wain / <a href="http://www.glyphish.com" target="_blank">glyphish.com</a>. Licensed under the <a href="http://creativecommons.org/licenses/by/3.0/us/" target="_blank">Creative Commons Attribution 3.0 United States License</a>.
     
     </div>
     
     <div data-role="footer" data-position="fixed">
     <div data-role="navbar">
     <ul>
     <li><a href="#" id="tabA" data-icon="custom">One</a></li>
     <li><a href="#" id="tabB" data-icon="custom" class="ui-btn-active">Two</a></li>
     <li><a href="#" id="tabC" data-icon="custom">Three</a></li>
     </ul>
     </div><!-- /navbar -->
</div><!-- /footer -->

</div>

<script>
    function myFunc() {
/*        var PLUGIN_NAME                         = "MyHybridBridge";
        var ACTION_SWITCH_APPS                 = "ACTION_SWITCH_APPS";
        
        var accessToken = localStorage.getItem("access_token");
        var refreshToken = localStorage.getItem("refresh_token");
        var dataArray = [accessToken, refreshToken];
        
        cordova.exec(null, null, PLUGIN_NAME, ACTION_SWITCH_APPS, dataArray);
        */
//    alert("trying to launch startapp");
        var accessToken = localStorage.getItem("access_token");
   //     alert("token" + accessToken);
        var username = localStorage.getItem("saved_username");
        var password = localStorage.getItem("saved_password");
  //      alert("username " + username + " password " + password);
        var destinationString = "goToMovenActual://" + accessToken + "/" + username + "/" + password;
    //    alert("destinationString --" + destinationString);
                              navigator.startApp.start(destinationString, function(message) { /* success */
                                                       console.log(message); // => OK
                                                       },
                                                       function(error) { /* error */
                                                       console.log('47', error);
                                                       });
    }

function reset() {
    document.getElementById("username").value = "";
    document.getElementById("password").value = "";
    document.getElementById("incorrectUsernamePassword").innerHTML = "";
    localStorage.setItem("comingFromMovenLogin","no");
    document.getElementById("mainTitle").innerHTML = "myBank";
    
    window.open("#loginPage");
    location.reload();
    
}

function updateContent( data ) {
  //  alert("UpdateContent" + data);
    var array = data.split("/");
    var accessCodeFromMoven = array[0];
    var comingFromMovenLogin = array[1];
 //   alert("comingFromMovenLogin = "+ comingFromMovenLogin);
    localStorage.setItem("comingFromMovenLogin",comingFromMovenLogin);
    if(comingFromMovenLogin == "yes"){
  //      alert("inside yes comingFromMovenLogin = "+ comingFromMovenLogin);
        document.getElementById("mainTitle").innerHTML = "myBank <br> Financial Wellness";
        document.getElementById("pic").src="img/BankWellnessIcon.png";
    }else{
        document.getElementById("mainTitle").innerHTML = "myBank";
        document.getElementById("pic").src="img/Bank_icon2.png";
    }
    var savedAccessCode = localStorage.getItem("access_token");
    if(savedAccessCode == accessCodeFromMoven || comingFromMovenLogin == "no"){
        window.open("#mainPage");
    }else{
        window.open("#loginPage");
    }
    document.getElementById( "dataPassedIn" ).innerHTML = data;
}

function reloadPage() {
    
 //   alert("Inside reload");
 //   document.getElementById("username").value = "";
 //   document.getElementById("password").value = "";
//    document.getElementById("incorrectUsernamePassword").innerHTML = "";
    localStorage.setItem("comingFromMovenLogin","yes");
 //   document.getElementById("mainTitle").innerHTML = "myBank";
    
    window.open("#loginPage");
    location.reload();
    
}

</script>
<script>


function getAccessCodeFromServerAndLogin()
{
    var xmlhttp;
    
    xmlhttp=new XMLHttpRequest();
    
    xmlhttp.onreadystatechange=function()
    {
        if (xmlhttp.readyState==4 && xmlhttp.status==200)
        {

            var parsedJSON = JSON.parse(xmlhttp.responseText);
            localStorage.setItem("access_token", parsedJSON.access_token);
            localStorage.setItem("refresh_token", parsedJSON.refresh_token);
            var savedAccessCode = localStorage.getItem("comingFromMovenLogin");

            if(savedAccessCode == "yes"){

                myFunc();
                
            }else{
                window.location = "#mainPage";
            }
            
        }else{

            if(xmlhttp.readyState == 4 && xmlhttp.status != 200){
                document.getElementById( "incorrectUsernamePassword" ).innerHTML = "Incorrect Username or Password";
            }
        }
    }
    
    var username = document.getElementById("username").value;
    var password = document.getElementById("password").value;
    localStorage.setItem("saved_username", username);
    localStorage.setItem("saved_password", password);
    document.getElementById("username").value = "";
    document.getElementById("password").value = "";
    var encodedData = window.btoa("client1.id:client1.secret");
    var codes = "Basic "+ encodedData;
    xmlhttp.open("POST","https://oauth-temp.moven.com/token",true);
    xmlhttp.setRequestHeader("Authorization",codes);
    xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xmlhttp.send("grant_type=password&username="+username+"&password="+password);
    
}

</script>
<script>
    var savedAccessCode = localStorage.getItem("comingFromMovenLogin");
//    alert(savedAccessCode);
    if(savedAccessCode == "yes"){
        document.getElementById("mainTitle").innerHTML = "myBank FWM";
        document.getElementById("pic").src="img/BankWellnessIcon.png";
    }else{
        document.getElementById("mainTitle").innerHTML = "myBank";
        document.getElementById("pic").src="img/Bank_icon2.png";
    }

//reloadPage();
    </script>

</body>
</html>